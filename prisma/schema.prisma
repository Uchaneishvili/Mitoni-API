generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

model Staff {
  id             String         @id @default(uuid())
  firstName      String
  lastName       String
  specialization String?
  avatarUrl      String?
  isActive       Boolean        @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  services     StaffService[]
  reservations Reservation[]

  @@map("staff")
}

model Service {
  id              String   @id @default(uuid())
  name            String
  durationMinutes Int
  price           Decimal  @db.Decimal(10, 2)
  isActive        Boolean  @default(true)
  color           String?
  customFields    Json?    @default("{}")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  staff        StaffService[]
  reservations Reservation[]

  @@map("services")
}

model StaffService {
  id        String   @id @default(uuid())
  staffId   String
  serviceId String
  createdAt DateTime @default(now())

  staff   Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([staffId, serviceId])
  @@map("staff_services")
}

model Reservation {
  id            String            @id @default(uuid())
  staffId       String
  serviceId     String
  customerName  String
  customerPhone String?
  startTime     DateTime
  endTime       DateTime
  status        ReservationStatus @default(PENDING)
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  staff   Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([staffId, startTime, endTime])
  @@index([startTime, endTime])
  @@map("reservations")
}
